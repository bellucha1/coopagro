<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cooperativa de Insumos</title>
<style>
    /* Variáveis e Configurações (Simulando o Tailwind config) */
    :root {
        --coop-green: #10B981; /* Emerald 500 */
        --coop-dark: #1F2937; /* Gray 800 */
        --bg-light: #f9fafb; /* Gray 50 */
        --text-light: #1f2937; /* Gray 800 */
        --bg-dark: #111827; /* Gray 900 */
        --text-dark: #f3f4f6; /* Gray 100 */
        --bg-header-light: white;
        --bg-header-dark: #1f2937; /* Gray 800 */
        --bg-nav-light: #e5e7eb; /* Gray 200 */
        --bg-nav-dark: #374151; /* Gray 700 */
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
    }

    /* Estilos base (Simulando Tailwind base) */
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        background-color: var(--bg-light);
        color: var(--text-light);
        transition: background-color 0.3s, color 0.3s;
    }
    .dark body {
        background-color: var(--bg-dark);
        color: var(--text-dark);
    }
    .container {
        max-width: 1280px;
        margin-left: auto;
        margin-right: auto;
        padding: 1rem;
    }
    .hidden {
        display: none !important;
    }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .justify-between { justify-content: space-between; }
    .items-center { align-items: center; }
    .p-4 { padding: 1rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .text-2xl { font-size: 1.5rem; }
    .font-bold { font-weight: 700; }
    .font-extrabold { font-weight: 800; }
    .rounded-lg { border-radius: 0.5rem; }
    .shadow-md { box-shadow: var(--shadow-md); }
    .shadow-lg { box-shadow: var(--shadow-lg); }
    .transition { transition: all 0.15s ease-in-out; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .text-center { text-align: center; }

    /* Estilos Específicos */
    header {
        background-color: var(--bg-header-light);
        box-shadow: var(--shadow-md);
        position: sticky;
        top: 0;
        z-index: 10;
    }
    .dark header {
        background-color: var(--bg-header-dark);
    }

    nav {
        background-color: var(--bg-nav-light);
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
    }
    .dark nav {
        background-color: var(--bg-nav-dark);
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.2);
    }

    .nav-button {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
    }
    .nav-button:not(.active) {
        background-color: #f3f4f6; /* Gray 100 */
        color: #374151; /* Gray 700 */
    }
    .dark .nav-button:not(.active) {
        background-color: #374151; /* Gray 700 */
        color: #f3f4f6; /* Gray 100 */
    }
    .nav-button:not(.active):hover {
        background-color: rgba(16, 185, 129, 0.2); /* coop-green/20 */
    }
    .nav-button.active {
        background-color: var(--coop-green);
        color: white;
    }
    .dark .nav-button.active {
        background-color: var(--coop-green); /* Dark mode active is same for contrast */
    }

    .card {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid #e5e7eb;
        transition: transform 0.15s, box-shadow 0.15s;
    }
    .dark .card {
        background-color: var(--bg-header-dark);
        border-color: #374151;
    }
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }

    /* Layout Grids */
    #catalogo-lista {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    /* Modal */
    #custom-modal {
        background-color: rgba(0, 0, 0, 0.5);
    }
    #custom-modal > div {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        max-width: 400px;
        width: 100%;
    }
    .dark #custom-modal > div {
        background-color: var(--bg-header-dark);
    }

    /* Utils */
    .text-coop-green { color: var(--coop-green); }
    .bg-coop-green { background-color: var(--coop-green); }
    .bg-coop-green:hover { background-color: rgba(16, 185, 129, 0.8); }
</style>
</head>

<body class="bg-gray-50 text-gray-800">

<header class="p-4 flex justify-between items-center">
    <div class="flex items-center" style="gap: 0.75rem;">
        <h1 class="text-2xl font-bold text-coop-green">🌾 Cooperativa de Insumos</h1>
        <div id="user-info" class="text-sm text-gray-500">Usuário ID: Mocked...</div>
    </div>
    <button id="modo-btn" class="px-4 py-2 rounded-lg shadow-sm transition" style="background-color: #f3f4f6; color: #374151;">
        🌙 Modo Escuro
    </button>
</header>

<nav class="p-3 shadow-inner flex justify-center">
    <div class="flex" style="gap: 1rem;">
        <button id="nav-home" onclick="mostrar('home')" class="nav-button active">Início</button>
        <button id="nav-catalogo" onclick="mostrar('catalogo')" class="nav-button">Catálogo</button>
        <button id="nav-carrinho" onclick="mostrar('carrinho')" class="nav-button">🛒 Carrinho</button>
        </div>
</nav>

<main class="container p-4">

    <section id="home" class="py-12 text-center card">
        <h2 class="text-4xl font-extrabold text-coop-green" style="margin-bottom: 1rem;">Bem-vindo à sua Cooperativa!</h2>
        <p class="text-lg" style="margin-bottom: 1.5rem; max-width: 500px; margin-left: auto; margin-right: auto;">Gerencie seus insumos e pedidos de forma prática, transparente e em tempo real (simulado).</p>
        <img src="https://placehold.co/400x200/10B981/ffffff?text=Cooperativa+Digital" alt="Trator" style="margin-left: auto; margin-right: auto; border-radius: 0.5rem; box-shadow: var(--shadow-lg);">
        <p class="mt-8 text-sm text-gray-500" style="margin-top: 2rem;">ID de usuário: <span id="current-user-id" style="font-family: monospace; background-color: #f3f4f6; padding: 0.25rem; border-radius: 0.25rem; font-size: 0.75rem; color: #6b7280;">USER-12345-MOCK</span></p>
    </section>

    <section id="catalogo" class="hidden py-8">
        <h2 class="text-3xl font-bold" style="margin-bottom: 1.5rem; border-bottom: 2px solid rgba(16, 185, 129, 0.5); padding-bottom: 0.5rem;">Catálogo de Insumos</h2>
        <div id="catalogo-lista">
            <p id="catalogo-loading" style="text-align: center; color: #6b7280; grid-column: 1 / -1;">Carregando catálogo...</p>
        </div>
    </section>

    <section id="carrinho" class="hidden py-8">
        <h2 class="text-3xl font-bold" style="margin-bottom: 1.5rem; border-bottom: 2px solid rgba(16, 185, 129, 0.5); padding-bottom: 0.5rem;">🛒 Seu Carrinho</h2>
        <div class="card p-6">
            <ul id="carrinho-lista" style="list-style: none; padding: 0; margin-bottom: 0; border-top: 1px solid #e5e7eb;">
                <li id="carrinho-vazio" style="padding: 0.5rem 0; color: #6b7280;">O seu carrinho está vazio.</li>
            </ul>
            <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #d1d5db; display: flex; justify-content: space-between; align-items: center;">
                <h3 id="total" class="text-xl font-extrabold text-coop-green">Total: R$ 0,00</h3>
                <button onclick="finalizarPedido()" class="px-6 py-3 bg-coop-green text-white font-semibold rounded-lg shadow-lg transition" id="btn-finalizar-pedido" disabled>
                    Finalizar Pedido
                </button>
            </div>
        </div>
    </section>

    <div id="custom-modal" class="fixed hidden items-center justify-center" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0;">
        <div>
            <h3 id="modal-title" class="text-xl font-bold" style="margin-bottom: 0.75rem; color: var(--coop-dark);"></h3>
            <p id="modal-message" style="margin-bottom: 1.25rem; color: #4b5563;"></p>
            <div id="modal-actions" class="flex justify-end" style="gap: 0.75rem;">
                </div>
        </div>
    </div>

</main>

<footer style="background-color: #d1d5db; padding: 1rem; text-align: center; font-size: 0.875rem; color: #4b5563; margin-top: 2rem;">
    <p>© 2025 Cooperativa Verde Sustentável | Simulação em HTML/CSS/JS Puro</p>
</footer>

<script>
    // --- DADOS MOCKADOS (Substituindo Firestore) ---
    const initialInsumos = [
        { id: '1', name: "Fertilizante NPK 10-10-10", price: 150.50, unit: "Saco (50kg)", estoque: 500 },
        { id: '2', name: "Semente de Soja (Cultivar X)", price: 320.00, unit: "Hectare", estoque: 150 },
        { id: '3', name: "Defensivo Fungicida", price: 285.90, unit: "Litro", estoque: 800 },
        { id: '4', name: "Corretivo de Solo (Calcário)", price: 45.00, unit: "Ton", estoque: 1200 },
        { id: '5', name: "Ureia Granulada", price: 180.00, unit: "Saco (50kg)", estoque: 600 },
        { id: '6', name: "Pneu para Trator", price: 2500.00, unit: "Unidade", estoque: 50 },
    ];
    let carrinhoData = []; // Armazena os itens do carrinho localmente

    // --- UTILS DE UI ---

    // Função para mostrar seção
    const mostrar = (sectionId) => {
        const sections = ['home', 'catalogo', 'carrinho'];
        sections.forEach(id => {
            const section = document.getElementById(id);
            const navBtn = document.getElementById(`nav-${id}`);
            if (section) {
                section.classList.add('hidden');
            }
            if (navBtn) {
                navBtn.classList.remove('active');
            }
        });

        const activeSection = document.getElementById(sectionId);
        const activeNavBtn = document.getElementById(`nav-${sectionId}`);
        if (activeSection) {
            activeSection.classList.remove('hidden');
        }
        if (activeNavBtn) {
            activeNavBtn.classList.add('active');
        }
    };
    window.mostrar = mostrar; // Torna acessível no onclick do HTML

    // Função de Modal Personalizado
    const customModal = (title, message, actions) => {
        const modal = document.getElementById('custom-modal');
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-message').textContent = message;
        
        const actionsContainer = document.getElementById('modal-actions');
        actionsContainer.innerHTML = '';
        
        actions.forEach(action => {
            const button = document.createElement('button');
            button.textContent = action.label;
            // Simplificação de classes CSS para o modal
            button.className = action.class || 'px-4 py-2 rounded-lg transition';
            button.style.cssText = action.style || 'padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.15s;';
            if (action.class && action.class.includes('bg-coop-green')) {
                button.style.backgroundColor = 'var(--coop-green)';
                button.style.color = 'white';
            } else {
                button.style.backgroundColor = '#d1d5db'; // Gray 300
                button.style.color = 'black';
            }

            button.onclick = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                if (action.callback) action.callback();
            };
            actionsContainer.appendChild(button);
        });

        modal.classList.remove('hidden');
        modal.classList.add('flex');
    };

    // --- LÓGICA DO MODO ESCURO ---
    document.getElementById('modo-btn').addEventListener('click', () => {
        if (document.documentElement.classList.contains('dark')) {
            document.documentElement.classList.remove('dark');
            document.getElementById('modo-btn').textContent = '🌙 Modo Escuro';
            localStorage.setItem('theme', 'light');
        } else {
            document.documentElement.classList.add('dark');
            document.getElementById('modo-btn').textContent = '☀️ Modo Claro';
            localStorage.setItem('theme', 'dark');
        }
    });

    const initTheme = () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.getElementById('modo-btn').textContent = '☀️ Modo Claro';
        }
    };

    // --- LÓGICA DO CATÁLOGO (LEITURA) ---

    const renderCatalog = (items) => {
        const lista = document.getElementById('catalogo-lista');
        const loading = document.getElementById('catalogo-loading');
        lista.innerHTML = '';
        if(loading) loading.classList.add('hidden'); // Esconde a mensagem de loading

        if (items.length === 0) {
            lista.innerHTML = '<p style="text-align: center; color: #6b7280; grid-column: 1 / -1;">Nenhum insumo encontrado no catálogo.</p>';
            return;
        }

        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <h3 class="text-xl font-bold text-coop-green" style="margin-bottom: 0.5rem;">${item.name}</h3>
                <p class="text-3xl font-extrabold" style="margin-bottom: 0.75rem;">R$ ${item.price.toFixed(2)}</p>
                <p class="text-sm" style="color: #6b7280; margin-bottom: 1rem;">Unidade: ${item.unit}</p>
                <p class="text-xs" style="color: #9ca3af; margin-bottom: 1rem;">Em estoque: ${item.estoque || 'N/D'}</p>
                <button 
                    onclick="addItemToCart('${item.id}', '${item.name.replace(/'/g, "\\'")}', ${item.price})" 
                    style="width: 100%; padding: 0.5rem 1rem; background-color: #3b82f6; color: white; font-weight: 600; border-radius: 0.5rem; transition: background-color 0.15s;"
                >
                    Adicionar ao Carrinho
                </button>
            `;
            lista.appendChild(card);
        });
    };

    const loadCatalog = () => {
        // Simula o carregamento dos dados iniciais
        renderCatalog(initialInsumos);
    };

    // --- LÓGICA DO CARRINHO (CRUD Local) ---

    const renderCart = (items) => {
        carrinhoData = items;
        const lista = document.getElementById('carrinho-lista');
        const totalElement = document.getElementById('total');
        const emptyMessage = document.getElementById('carrinho-vazio');
        const finalizarBtn = document.getElementById('btn-finalizar-pedido');
        
        lista.innerHTML = '';
        let total = 0;

        if (items.length === 0) {
            emptyMessage.classList.remove('hidden');
            finalizarBtn.disabled = true;
            lista.appendChild(emptyMessage);
        } else {
            emptyMessage.classList.add('hidden');
            finalizarBtn.disabled = false;

            items.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                const listItem = document.createElement('li');
                listItem.style.cssText = 'display: flex; flex-direction: column; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;';
                
                listItem.innerHTML = `
                    <div style="flex: 1; min-width: 0; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <p class="text-lg font-semibold" style="color: var(--coop-dark); margin-bottom: 0.25rem;">${item.name}</p>
                            <p class="text-sm" style="color: #6b7280;">R$ ${item.price.toFixed(2)} / un.</p>
                        </div>
                        <div style="font-weight: 700; width: 100px; text-align: right;">R$ ${subtotal.toFixed(2)}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem; justify-content: flex-end;">
                        <div style="display: flex; align-items: center; border: 1px solid #d1d5db; border-radius: 0.5rem;">
                            <button onclick="updateItemQuantity('${item.insumoId}', ${item.quantity - 1})" 
                                style="padding: 0.25rem 0.75rem; color: var(--coop-green); background-color: transparent; border: none; cursor: pointer; border-right: 1px solid #d1d5db;">-</button>
                            <span style="width: 30px; text-align: center; padding: 0.25rem 0;">${item.quantity}</span>
                            <button onclick="updateItemQuantity('${item.insumoId}', ${item.quantity + 1})" 
                                style="padding: 0.25rem 0.75rem; color: var(--coop-green); background-color: transparent; border: none; cursor: pointer; border-left: 1px solid #d1d5db;">+</button>
                        </div>
                        <button onclick="removeItemFromCart('${item.insumoId}')" style="padding: 0.5rem; color: #ef4444; border: none; background: none; cursor: pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                `;
                lista.appendChild(listItem);
            });
        }
        totalElement.textContent = `Total: R$ ${total.toFixed(2)}`;
    };
    
    // Simula a adição (ou atualização) de um item no carrinho
    const addItemToCart = (insumoId, name, price) => {
        const existingItem = carrinhoData.find(item => item.insumoId === insumoId);

        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            carrinhoData.push({
                insumoId,
                name,
                price,
                quantity: 1
            });
        }
        renderCart(carrinhoData);
        customModal("Adicionado!", `${name} foi adicionado ao seu carrinho.`, [{ label: "Continuar Comprando", class: "bg-coop-green text-white", style: 'background-color: var(--coop-green); color: white;' }]);
    };
    window.addItemToCart = addItemToCart;

    // Simula a remoção de um item
    const removeItemFromCart = (insumoId) => {
        carrinhoData = carrinhoData.filter(item => item.insumoId !== insumoId);
        renderCart(carrinhoData);
    };
    window.removeItemFromCart = removeItemFromCart;

    // Simula a atualização da quantidade
    const updateItemQuantity = (insumoId, newQuantity) => {
        if (newQuantity < 1) {
             customModal("Atenção", "A quantidade mínima permitida é 1. Use o ícone de lixeira para exclusão.", [{ label: "OK", class: "bg-coop-green text-white", style: 'background-color: var(--coop-green); color: white;' }]);
             return;
        }
        const item = carrinhoData.find(item => item.insumoId === insumoId);
        if (item) {
            item.quantity = newQuantity;
            renderCart(carrinhoData);
        }
    }
    window.updateItemQuantity = updateItemQuantity;

    // Simula a finalização do pedido
    const processarPedido = () => {
        console.log("Pedido processado:", carrinhoData);
        carrinhoData = []; // Esvazia o carrinho
        renderCart(carrinhoData); // Renderiza a lista vazia
        customModal("Pedido Realizado!", "Seu pedido foi finalizado com sucesso e seu carrinho esvaziado!", [{ label: "Ótimo!", class: "bg-coop-green text-white", style: 'background-color: var(--coop-green); color: white;' }]);
    };

    const finalizarPedido = () => {
        if (carrinhoData.length === 0) {
            customModal("Carrinho Vazio", "Seu carrinho precisa ter itens para finalizar o pedido.", [{ label: "OK", class: "bg-red-500 text-white", style: 'background-color: #ef4444; color: white;' }]);
            return;
        }

        const total = carrinhoData.reduce((sum, item) => sum + item.price * item.quantity, 0);

        customModal("Confirmar Pedido", 
            `O valor total do seu pedido é R$ ${total.toFixed(2)}. Deseja confirmar e esvaziar o carrinho?`,
            [
                { label: "Cancelar", class: "bg-gray-300 text-gray-800" },
                { 
                    label: "Confirmar Pedido", 
                    class: "bg-coop-green text-white", 
                    style: 'background-color: var(--coop-green); color: white;',
                    callback: processarPedido
                }
            ]
        );
    }
    window.finalizarPedido = finalizarPedido;

    // --- INICIALIZAÇÃO DA APLICAÇÃO ---

    window.onload = () => {
        initTheme();
        loadCatalog(); // Carrega o catálogo mockado
        renderCart(carrinhoData); // Inicializa o carrinho vazio
        mostrar('home'); // Exibe a seção inicial
    };
</script>
</body>
</html>
